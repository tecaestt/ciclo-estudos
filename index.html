<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronômetro de Estudos Avançado - by @tecaestt</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2d3748;
            border-bottom: 3px solid #4a5568;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .input-field {
            display: flex;
            flex-direction: column;
        }
        
        .input-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #34495e;
        }
        
        .input-field input, .input-field select {
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #4a5568;
        }
        
        .btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 85, 104, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #38a169, #2f855a);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #dd6b20, #c05621);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3182ce, #2c5282);
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .resultado {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #38a169;
        }
        
        .resultado h3 {
            color: #38a169;
            margin-top: 0;
        }
        
        .ciclo-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #4a5568;
        }
        
        .ciclo-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .ciclo-item.atual {
            border-left-color: #38a169;
            background: #f0fff4;
        }
        
        .ciclo-item.concluido {
            border-left-color: #a0aec0;
            background: #f7fafc;
            opacity: 0.7;
        }
        
        .ciclo-info {
            flex: 1;
        }
        
        .ciclo-info h4 {
            margin: 0 0 5px 0;
            color: #2d3748;
        }
        
        .ciclo-info small {
            color: #6c757d;
        }
        
        .ciclo-tempo {
            background: #4a5568;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .ciclo-tempo.atual {
            background: #38a169;
        }
        
        .ciclo-tempo.concluido {
            background: #a0aec0;
        }
        
        .controles {
            text-align: center;
            margin: 20px 0;
        }
        
        .progresso-ciclo {
            background: #ecf0f1;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progresso-fill {
            background: linear-gradient(135deg, #38a169, #2f855a);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4a5568;
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #2d3748;
            font-size: 1.8em;
        }
        
        .stat-card p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
            border-left: 4px solid #dd6b20;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #0c5460;
            border-left: 4px solid #4a5568;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* ===== ESTILOS DOS CRONÔMETROS ===== */
        
        .cronometros-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .cronometro-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #4a5568;
            transition: all 0.3s ease;
        }
        
        .cronometro-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .cronometro-card.ativo {
            border-left-color: #38a169;
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
            animation: pulso-suave 2s infinite;
        }
        
        @keyframes pulso-suave {
            0%, 100% { 
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            }
            50% { 
                box-shadow: 0 15px 40px rgba(56, 161, 105, 0.2);
            }
        }
        
        .cronometro-titulo {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .cronometro-display {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .cronometro-tempo {
            font-size: 3em;
            font-weight: 300;
            margin-bottom: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            color: #2d3748;
        }
        
        .cronometro-info {
            font-size: 1em;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .cronometro-progresso {
            margin: 15px 0;
        }
        
        .cronometro-barra {
            background: #ecf0f1;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .cronometro-fill {
            background: linear-gradient(90deg, #4ade80, #22c55e);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .cronometro-meta {
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
        }
        
        .cronometro-controles {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn-cronometro {
            background: #4a5568;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 90px;
        }
        
        .btn-cronometro:hover:not(:disabled) {
            background: #2d3748;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-cronometro:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-play {
            background: #38a169 !important;
        }
        
        .btn-pause {
            background: #dd6b20 !important;
        }
        
        .btn-stop {
            background: #e53e3e !important;
        }
        
        .btn-complete {
            background: #8b5cf6 !important;
        }
        
        .cronometro-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-mini {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-valor {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 2px;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #6c757d;
        }

        /* Estilos específicos para cada tipo de cronômetro */
        .cronometro-meta {
            border-left-color: #3182ce;
        }
        
        .cronometro-livre {
            border-left-color: #8b5cf6;
        }
        
        .cronometro-pomodoro {
            border-left-color: #e53e3e;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 15px;
            }
            
            .input-group {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 14px;
                margin: 8px 4px;
                width: 100%;
                max-width: none;
            }
            
            .cronometros-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .cronometro-tempo {
                font-size: 2.5em;
            }
            
            .btn-cronometro {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 80px;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⏱️ Cronômetro de Estudos Avançado</h1>
            <p>Sistema completo de cronometragem e gestão de estudos</p>
        </div>
        
        <div class="content">
            <!-- Configuração Básica -->
            <div class="section">
                <h2>⚙️ Configuração Básica</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label>Horas disponíveis (Segunda a Sexta)</label>
                        <input type="number" id="horasSegSex" value="2" min="0.5" max="12" step="0.5" onchange="calcularSessoesPorDia()">
                    </div>
                    <div class="input-field">
                        <label>Horas disponíveis (Sábado)</label>
                        <input type="number" id="horasSabado" value="4" min="0" max="12" step="0.5" onchange="calcularSessoesPorDia()">
                    </div>
                    <div class="input-field">
                        <label>Horas disponíveis (Domingo)</label>
                        <input type="number" id="horasDomingo" value="3" min="0" max="12" step="0.5" onchange="calcularSessoesPorDia()">
                    </div>
                    <div class="input-field">
                        <label>Duração base da sessão (minutos)</label>
                        <select id="duracaoSessao" onchange="calcularSessoesPorDia()">
                            <option value="25">25 min (Pomodoro)</option>
                            <option value="30">30 min (Iniciante)</option>
                            <option value="45" selected>45 min (Intermediário)</option>
                            <option value="60">60 min (Avançado)</option>
                            <option value="90">90 min (Expert)</option>
                        </select>
                    </div>
                </div>
                <div class="resultado">
                    <h3>📊 Horas semanais: <span id="horasSemanais">19</span>h | Sessões: <span id="sessoesSemanais">25</span></h3>
                    <p>💡 Tempo produtivo estimado: <span id="tempoLiquido">18h45</span></p>
                </div>
            </div>

            <!-- Cadastro de Matérias -->
            <div class="section">
                <h2>📚 Cadastro de Matérias</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label>Nome da Matéria</label>
                        <select id="nomeMateria" onchange="toggleMateriaCustomizada()">
                            <option value="">Selecione uma matéria</option>
                            <option value="Administração Geral">Administração Geral</option>
                            <option value="Administração Pública">Administração Pública</option>
                            <option value="Direito Administrativo">Direito Administrativo</option>
                            <option value="Direito Civil">Direito Civil</option>
                            <option value="Direito Constitucional">Direito Constitucional</option>
                            <option value="Direito Penal">Direito Penal</option>
                            <option value="Direito Tributário">Direito Tributário</option>
                            <option value="Língua Portuguesa">Língua Portuguesa</option>
                            <option value="Raciocínio Lógico-Matemático">Raciocínio Lógico-Matemático</option>
                            <option value="Informática">Informática</option>
                            <option value="Contabilidade">Contabilidade</option>
                            <option value="Economia">Economia</option>
                            <option value="Estatística">Estatística</option>
                            <option value="✏️ Digitar outra matéria">✏️ Digitar outra matéria</option>
                        </select>
                        <input type="text" id="materiaCustomizada" placeholder="Digite o nome da matéria" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="input-field">
                        <label>Importância no Edital (1-10)</label>
                        <input type="number" id="pesoMateria" min="1" max="10" value="5">
                        <small style="color: #6c757d;">1=Baixa, 5=Média, 10=Muito Alta</small>
                    </div>
                    <div class="input-field">
                        <label>Sua Dificuldade (1-5)</label>
                        <select id="dificuldadeMateria">
                            <option value="1">1 - Muito Fácil</option>
                            <option value="2">2 - Fácil</option>
                            <option value="3" selected>3 - Médio</option>
                            <option value="4">4 - Difícil</option>
                            <option value="5">5 - Muito Difícil</option>
                        </select>
                    </div>
                    <div class="input-field">
                        <label>Prioridade Pessoal (1-5)</label>
                        <select id="prioridadeMateria">
                            <option value="1">1 - Baixa</option>
                            <option value="2">2 - Baixa-Média</option>
                            <option value="3" selected>3 - Média</option>
                            <option value="4">4 - Alta</option>
                            <option value="5">5 - Muito Alta</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn" onclick="adicionarMateria()">➕ Adicionar Matéria</button>
                    <button class="btn btn-success" onclick="gerarCiclo()">🔄 Gerar Ciclo</button>
                    <button class="btn btn-danger" onclick="limparTudo()">🗑️ Limpar Tudo</button>
                </div>
            </div>

            <!-- Tabela de Matérias -->
            <div class="section">
                <h2>📋 Matérias Cadastradas</h2>
                <div class="table-container">
                    <table id="tabelaMaterias">
                        <thead>
                            <tr>
                                <th>Matéria</th>
                                <th>Importância</th>
                                <th>Dificuldade</th>
                                <th>Prioridade</th>
                                <th>Pontuação Final</th>
                                <th>Tempo por Sessão</th>
                                <th>Sessões no Ciclo</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Matérias Estudadas Hoje -->
            <div class="section" id="materiasHojeSection" style="display: none;">
                <h2>📅 Resumo do Dia</h2>
                <div id="materiasHojeEstatisticas" class="stats"></div>
                <div class="ciclo-container">
                    <h3 style="text-align: center; color: #2d3748; margin-bottom: 20px;">📊 Distribuição do Tempo por Matéria</h3>
                    <div id="materiasHojeGrafico" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- Cronômetros -->
            <div class="section">
                <h2>⏱️ Cronômetros de Estudo</h2>
                <div class="info">
                    <strong>💡 Três tipos de cronômetros:</strong><br>
                    • <strong>Meta de Estudos:</strong> Cronômetro vinculado ao ciclo de estudos com tempo específico por matéria<br>
                    • <strong>Tempo Livre:</strong> Cronômetro independente para estudar qualquer matéria por tempo personalizado<br>
                    • <strong>Pomodoro:</strong> Técnica de 25min de estudo + 5min de pausa (ciclos automáticos)
                </div>
                
                <div class="cronometros-container">
                    <!-- Cronômetro Meta de Estudos -->
                    <div class="cronometro-card cronometro-meta" id="cronometroMeta">
                        <div class="cronometro-titulo">🎯 Meta de Estudos</div>
                        <div class="cronometro-display">
                            <div class="cronometro-tempo" id="tempoMeta">00:00</div>
                            <div class="cronometro-info" id="infoMeta">Próxima sessão: Gere um ciclo primeiro</div>
                            <div class="cronometro-progresso">
                                <div class="cronometro-barra">
                                    <div class="cronometro-fill" id="fillMeta" style="width: 0%"></div>
                                </div>
                                <div class="cronometro-meta" id="metaMeta">Meta: --:--</div>
                            </div>
                        </div>
                        <div class="cronometro-controles">
                            <button class="btn-cronometro btn-play" id="playMeta" onclick="iniciarCronometroMeta()">▶️ Iniciar</button>
                            <button class="btn-cronometro btn-pause" id="pauseMeta" onclick="pausarCronometroMeta()" disabled>⏸️ Pausar</button>
                            <button class="btn-cronometro btn-stop" id="stopMeta" onclick="pararCronometroMeta()" disabled>⏹️ Parar</button>
                            <button class="btn-cronometro btn-complete" id="completeMeta" onclick="completarSessaoMeta()" disabled>✅ Concluir</button>
                        </div>
                    </div>

                    <!-- Cronômetro Tempo Livre -->
                    <div class="cronometro-card cronometro-livre" id="cronometroLivre">
                        <div class="cronometro-titulo">🆓 Tempo Livre</div>
                        <div class="cronometro-display">
                            <div class="cronometro-tempo" id="tempoLivre">00:00</div>
                            <div class="cronometro-info" id="infoLivre">
                                <select id="materiaLivre" style="margin-bottom: 10px; padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="Outra Matéria">Outra Matéria</option>
                                </select>
                                <input type="number" id="tempoLivreInput" placeholder="Tempo (min)" min="1" max="300" value="30" 
                                       style="width: 100px; padding: 5px; border-radius: 5px; border: 1px solid #ddd; margin-left: 10px;">
                            </div>
                            <div class="cronometro-progresso">
                                <div class="cronometro-barra">
                                    <div class="cronometro-fill" id="fillLivre" style="width: 0%"></div>
                                </div>
                                <div class="cronometro-meta" id="metaLivre">Meta: 30:00</div>
                            </div>
                        </div>
                        <div class="cronometro-controles">
                            <button class="btn-cronometro btn-play" id="playLivre" onclick="iniciarCronometroLivre()">▶️ Iniciar</button>
                            <button class="btn-cronometro btn-pause" id="pauseLivre" onclick="pausarCronometroLivre()" disabled>⏸️ Pausar</button>
                            <button class="btn-cronometro btn-stop" id="stopLivre" onclick="pararCronometroLivre()" disabled>⏹️ Parar</button>
                            <button class="btn-cronometro btn-complete" id="completeLivre" onclick="completarSessaoLivre()" disabled>✅ Concluir</button>
                        </div>
                    </div>

                    <!-- Cronômetro Pomodoro -->
                    <div class="cronometro-card cronometro-pomodoro" id="cronometroPomodoro">
                        <div class="cronometro-titulo">🍅 Pomodoro</div>
                        <div class="cronometro-display">
                            <div class="cronometro-tempo" id="tempoPomodoro">25:00</div>
                            <div class="cronometro-info" id="infoPomodoro">
                                <select id="materiaPomodoro" style="margin-bottom: 10px; padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="Outra Matéria">Outra Matéria</option>
                                </select>
                                <div style="font-size: 0.9em; color: #6c757d;">Ciclo: <span id="cicloPomodoro">1</span> | Fase: <span id="fasePomodoro">Estudo</span></div>
                            </div>
                            <div class="cronometro-progresso">
                                <div class="cronometro-barra">
                                    <div class="cronometro-fill" id="fillPomodoro" style="width: 0%"></div>
                                </div>
                                <div class="cronometro-meta" id="metaPomodoro">25min estudo → 5min pausa</div>
                            </div>
                        </div>
                        <div class="cronometro-controles">
                            <button class="btn-cronometro btn-play" id="playPomodoro" onclick="iniciarCronometroPomodoro()">▶️ Iniciar</button>
                            <button class="btn-cronometro btn-pause" id="pausePomodoro" onclick="pausarCronometroPomodoro()" disabled>⏸️ Pausar</button>
                            <button class="btn-cronometro btn-stop" id="stopPomodoro" onclick="pararCronometroPomodoro()" disabled>⏹️ Parar</button>
                            <button class="btn-cronometro" id="skipPomodoro" onclick="pularFasePomodoro()" disabled>⏭️ Pular Fase</button>
                        </div>
                        <div class="cronometro-stats">
                            <div class="stat-mini">
                                <span class="stat-valor" id="pomodorosCompletos">0</span>
                                <span class="stat-label">Pomodoros Hoje</span>
                            </div>
                            <div class="stat-mini">
                                <span class="stat-valor" id="tempoFoco">0min</span>
                                <span class="stat-label">Tempo Foco</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas Gerais do Dia -->
                <div class="stats" style="margin-top: 30px;">
                    <div class="stat-card">
                        <h3 id="tempoTotalHoje">0h00min</h3>
                        <p>Tempo Total Estudado Hoje</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="sessoesTotalHoje">0</h3>
                        <p>Sessões Concluídas Hoje</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="materiasHoje">0</h3>
                        <p>Matérias Diferentes</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="metaHoje">0%</h3>
                        <p>Meta Diária</p>
                    </div>
                </div>
            </div>

            <!-- Ciclo de Estudos -->
            <div class="section">
                <h2>🔄 Seu Ciclo de Estudos</h2>
                <div id="cicloInfo" class="info" style="display: none;">
                    <strong>Como funciona:</strong> O cronômetro "Meta de Estudos" segue automaticamente este ciclo. 
                    Cada matéria tem tempo personalizado baseado na importância, dificuldade e prioridade.
                </div>
                
                <div class="stats" id="statsContainer" style="display: none;">
                    <div class="stat-card">
                        <h3 id="totalSessoes">0</h3>
                        <p>Total de Sessões</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="tempoCompletoCiclo">0h</h3>
                        <p>Tempo Completo do Ciclo</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="diasPrevisto">0</h3>
                        <p>Dias para Completar</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="sessaoAtual">0</h3>
                        <p>Sessão Atual</p>
                    </div>
                </div>

                <div class="progresso-ciclo" id="progressoContainer" style="display: none;">
                    <div class="progresso-fill" id="progressoFill" style="width: 0%"></div>
                </div>

                <div class="controles" id="controlesContainer" style="display: none;">
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="marcarConcluida()">✅ Marcar Sessão Atual como Concluída</button>
                        <button class="btn btn-warning" onclick="reiniciarCiclo()">🔄 Reiniciar Ciclo</button>
                        <button class="btn" onclick="imprimirCiclo()">🖨️ Imprimir Checklist</button>
                    </div>
                </div>

                <div class="ciclo-container" id="cicloContainer">
                    <p style="text-align: center; color: #6c757d; font-style: italic;">
                        Adicione matérias e clique em "Gerar Ciclo" para começar
                    </p>
                </div>
            </div>

            <!-- Histórico de Estudos -->
            <div class="section" id="historicoSection" style="display: none;">
                <h2>📈 Histórico de Estudos</h2>
                <div id="historicoEstatisticas" class="stats"></div>
                <div class="ciclo-container">
                    <h3 style="text-align: center; color: #2d3748; margin-bottom: 20px;">📅 Últimas Sessões</h3>
                    <div id="historicoLista" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- Instruções -->
            <div class="section">
                <h2>📖 Como Usar</h2>
                <div class="warning">
                    <strong>🎯 Novidades desta versão:</strong><br>
                    • <strong>Três cronômetros independentes:</strong> Meta de estudos, tempo livre e Pomodoro<br>
                    • <strong>Sistema de pesos melhorado:</strong> Importância + Dificuldade + Prioridade pessoal<br>
                    • <strong>Tempo sempre contabilizado:</strong> Independente de concluir a meta ou não<br>
                    • <strong>Tempos personalizados:</strong> Cada matéria tem duração específica baseada na importância<br>
                    • <strong>Interface reorganizada:</strong> Resumo do dia e histórico em posições mais intuitivas
                </div>
                
                <div class="info">
                    <strong>📝 Passos para usar:</strong><br>
                    1. Configure suas horas disponíveis e duração base das sessões<br>
                    2. Adicione matérias com importância, dificuldade e prioridade pessoal<br>
                    3. Gere o ciclo para ver a distribuição inteligente de tempo<br>
                    4. Use o cronômetro "Meta de Estudos" para seguir o ciclo automaticamente<br>
                    5. Use "Tempo Livre" para estudos extras ou revisões<br>
                    6. Use "Pomodoro" para sessões focadas com pausas automáticas
                </div>
                
                <div class="info">
                    <strong>⏱️ Sobre os tempos das sessões:</strong><br>
                    • <strong>Fórmula:</strong> Tempo Base × (1 + Importância/20) × (1 + Dificuldade/10) × (1 + Prioridade/15)<br>
                    • <strong>Exemplo:</strong> Base 45min, Importância 8, Dificuldade 4, Prioridade 5 = 45 × 1.4 × 1.4 × 1.33 = 117min<br>
                    • <strong>Limites:</strong> Mínimo 15min, máximo 120min por sessão<br>
                    • <strong>Arredondamento:</strong> Múltiplos de 5 minutos para facilitar
                </div>
                
                <div class="warning">
                    <strong>💾 Salvamento automático:</strong><br>
                    Todos os tempos estudados são salvos automaticamente, mesmo se você parar o cronômetro antes da meta. 
                    Seus dados ficam seguros no navegador e você pode exportar para backup.
                </div>
            </div>

            <!-- Controles de Dados -->
            <div class="section" id="dadosSection" style="display: none;">
                <h2>💾 Gerenciar Dados</h2>
                <div class="ciclo-container">
                    <div class="btn-group">
                        <button class="btn" onclick="exportarDados()">📤 Exportar Dados</button>
                        <button class="btn" onclick="document.getElementById('importarArquivo').click()">📥 Importar Dados</button>
                        <button class="btn btn-danger" onclick="limparHistorico()">🗑️ Limpar Histórico</button>
                        <input type="file" id="importarArquivo" accept=".json" style="display: none;" onchange="importarDados(event)">
                    </div>
                    <div style="text-align: center; color: #6c757d; font-size: 0.9em; margin-top: 15px;">
                        <p>💡 Seus dados são salvos automaticamente no navegador</p>
                        <p>📱 Use exportar/importar para backup ou transferir entre dispositivos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== VARIÁVEIS GLOBAIS =====
        let materias = [];
        let cicloAtual = [];
        let sessaoAtualIndex = 0;
        let sessoesConcluidas = 0;
        let historicoEstudos = [];
        let estatisticasGerais = {
            totalSessoes: 0,
            totalTempo: 0,
            ciclosCompletos: 0,
            tempoTotalPorMateria: {},
            pomodorosCompletos: 0
        };

        // Variáveis dos cronômetros
        let cronometros = {
            meta: {
                ativo: false,
                pausado: false,
                inicio: 0,
                decorrido: 0,
                tempoMeta: 0,
                intervalo: null,
                sessao: null
            },
            livre: {
                ativo: false,
                pausado: false,
                inicio: 0,
                decorrido: 0,
                tempoMeta: 0,
                intervalo: null,
                materia: 'Outra Matéria'
            },
            pomodoro: {
                ativo: false,
                pausado: false,
                inicio: 0,
                decorrido: 0,
                tempoMeta: 25 * 60, // 25 minutos em segundos
                intervalo: null,
                materia: 'Outra Matéria',
                ciclo: 1,
                fase: 'estudo', // 'estudo' ou 'pausa'
                pomodorosHoje: 0,
                tempoFocoHoje: 0
            }
        };

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', function() {
            verificarLocalStorage();
            carregarDados();
            calcularSessoesPorDia();
            atualizarSelectsMaterias();
            atualizarEstatisticasDia();
            
            // Atualizar meta do tempo livre quando mudar o input
            document.getElementById('tempoLivreInput').addEventListener('change', function() {
                const tempo = parseInt(this.value) || 30;
                document.getElementById('metaLivre').textContent = `Meta: ${formatarTempoMM(tempo * 60)}`;
                if (!cronometros.livre.ativo) {
                    cronometros.livre.tempoMeta = tempo * 60;
                }
            });
        });

        // ===== FUNÇÕES BÁSICAS =====
        function verificarLocalStorage() {
            try {
                const teste = 'teste_localStorage';
                localStorage.setItem(teste, 'funcionando');
                const resultado = localStorage.getItem(teste);
                localStorage.removeItem(teste);
                
                if (resultado === 'funcionando') {
                    console.log('✅ LocalStorage funcionando corretamente');
                } else {
                    throw new Error('LocalStorage não retornou valor correto');
                }
            } catch (error) {
                console.error('❌ LocalStorage não está funcionando:', error);
                alert('⚠️ AVISO: O salvamento automático não está funcionando.\n\nUse "Exportar Dados" para fazer backup manual.');
            }
        }

        function salvarDados() {
            const dados = {
                materias: materias,
                cicloAtual: cicloAtual,
                sessaoAtualIndex: sessaoAtualIndex,
                sessoesConcluidas: sessoesConcluidas,
                historicoEstudos: historicoEstudos,
                estatisticasGerais: estatisticasGerais,
                dataUltimaSalvamento: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('cronometroEstudos', JSON.stringify(dados));
                console.log('✅ Dados salvos automaticamente');
            } catch (error) {
                console.warn('❌ Erro ao salvar dados:', error);
            }
        }

        function carregarDados() {
            try {
                const dados = localStorage.getItem('cronometroEstudos');
                if (dados) {
                    const dadosCarregados = JSON.parse(dados);
                    
                    materias = dadosCarregados.materias || [];
                    cicloAtual = dadosCarregados.cicloAtual || [];
                    sessaoAtualIndex = dadosCarregados.sessaoAtualIndex || 0;
                    sessoesConcluidas = dadosCarregados.sessoesConcluidas || 0;
                    historicoEstudos = dadosCarregados.historicoEstudos || [];
                    estatisticasGerais = dadosCarregados.estatisticasGerais || {
                        totalSessoes: 0,
                        totalTempo: 0,
                        ciclosCompletos: 0,
                        tempoTotalPorMateria: {},
                        pomodorosCompletos: 0
                    };
                    
                    // Atualizar interface
                    atualizarTabela();
                    atualizarVisualizacaoCiclo();
                    atualizarEstatisticas();
                    atualizarHistorico();
                    atualizarMateriasHoje();
                    atualizarSelectsMaterias();
                    
                    console.log('✅ Dados carregados com sucesso!');
                }
            } catch (error) {
                console.warn('❌ Erro ao carregar dados salvos:', error);
            }
        }

        function mostrarNotificacao(mensagem, tipo = 'info') {
            const notificacao = document.createElement('div');
            notificacao.textContent = mensagem;
            notificacao.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                z-index: 1001;
                opacity: 0;
                transform: translateX(20px);
                transition: all 0.3s ease;
                max-width: 300px;
            `;

            if (tipo === 'sucesso') {
                notificacao.style.background = 'linear-gradient(135deg, #38a169, #2f855a)';
            } else if (tipo === 'erro') {
                notificacao.style.background = 'linear-gradient(135deg, #e53e3e, #c53030)';
            } else if (tipo === 'aviso') {
                notificacao.style.background = 'linear-gradient(135deg, #dd6b20, #c05621)';
            } else {
                notificacao.style.background = 'linear-gradient(135deg, #4a5568, #2d3748)';
            }

            document.body.appendChild(notificacao);

            setTimeout(() => {
                notificacao.style.opacity = '1';
                notificacao.style.transform = 'translateX(0)';
            }, 10);

            setTimeout(() => {
                notificacao.style.opacity = '0';
                notificacao.style.transform = 'translateX(20px)';
                setTimeout(() => {
                    if (notificacao.parentNode) {
                        notificacao.parentNode.removeChild(notificacao);
                    }
                }, 300);
            }, 4000);
        }

        // ===== FUNÇÕES DE MATÉRIAS =====
        function toggleMateriaCustomizada() {
            const select = document.getElementById('nomeMateria');
            const input = document.getElementById('materiaCustomizada');
            
            if (select.value === '✏️ Digitar outra matéria') {
                input.style.display = 'block';
                input.focus();
            } else {
                input.style.display = 'none';
                input.value = '';
            }
        }

        function calcularSessoesPorDia() {
            const horasSegSex = parseFloat(document.getElementById('horasSegSex').value) || 2;
            const horasSabado = parseFloat(document.getElementById('horasSabado').value) || 4;
            const horasDomingo = parseFloat(document.getElementById('horasDomingo').value) || 3;
            const duracaoSessao = parseInt(document.getElementById('duracaoSessao').value) || 45;
            
            const horasSemanais = (horasSegSex * 5) + horasSabado + horasDomingo;
            const minutosSemanais = horasSemanais * 60;
            const sessoesSemanais = Math.floor(minutosSemanais / duracaoSessao);
            
            const tempoLiquido = (sessoesSemanais * duracaoSessao) / 60;
            
            document.getElementById('horasSemanais').textContent = horasSemanais.toFixed(1);
            document.getElementById('sessoesSemanais').textContent = sessoesSemanais;
            document.getElementById('tempoLiquido').textContent = formatarTempo(tempoLiquido);
        }

        function formatarTempo(horas) {
            const h = Math.floor(horas);
            const m = Math.round((horas - h) * 60);
            return `${h}h${m.toString().padStart(2, '0')}`;
        }

        function calcularDuracaoSessao(importancia, dificuldade, prioridade) {
            const duracaoBase = parseInt(document.getElementById('duracaoSessao').value) || 45;
            
            // Fórmula melhorada que considera todos os fatores
            const fatorImportancia = 1 + (importancia / 20); // 1.05 a 1.5
            const fatorDificuldade = 1 + (dificuldade / 10);  // 1.1 a 1.5
            const fatorPrioridade = 1 + (prioridade / 15);    // 1.07 a 1.33
            
            const duracao = duracaoBase * fatorImportancia * fatorDificuldade * fatorPrioridade;
            
            // Limites: mínimo 15min, máximo 120min
            const duracaoLimitada = Math.max(15, Math.min(120, duracao));
            
            // Arredondar para múltiplos de 5
            return Math.round(duracaoLimitada / 5) * 5;
        }

        function adicionarMateria() {
            const selectMateria = document.getElementById('nomeMateria');
            const inputCustomizado = document.getElementById('materiaCustomizada');
            const pesoMateria = document.getElementById('pesoMateria');
            const dificuldadeMateria = document.getElementById('dificuldadeMateria');
            const prioridadeMateria = document.getElementById('prioridadeMateria');
            
            let nome = '';
            if (selectMateria.value === '✏️ Digitar outra matéria') {
                nome = inputCustomizado.value.trim();
            } else {
                nome = selectMateria.value;
            }
            
            if (!nome) {
                mostrarNotificacao('❌ Por favor, selecione ou digite o nome da matéria', 'erro');
                return;
            }

            if (materias.some(m => m.nome === nome)) {
                mostrarNotificacao('⚠️ Esta matéria já foi adicionada!', 'aviso');
                return;
            }

            const importancia = parseInt(pesoMateria.value);
            const dificuldade = parseInt(dificuldadeMateria.value);
            const prioridade = parseInt(prioridadeMateria.value);
            
            // Pontuação final que considera todos os fatores
            const pontuacao = Math.pow(importancia, 1.5) * Math.pow(dificuldade, 1.2) * Math.pow(prioridade, 1.1);
            const duracaoSessao = calcularDuracaoSessao(importancia, dificuldade, prioridade);
            
            const materia = {
                nome,
                importancia,
                dificuldade,
                prioridade,
                pontuacao,
                duracaoSessao,
                sessoes: 0
            };

            materias.push(materia);
            salvarDados();
            atualizarTabela();
            atualizarSelectsMaterias();
            limparFormulario();
            
            mostrarNotificacao(`✅ "${nome}" adicionada! Duração: ${duracaoSessao}min`, 'sucesso');
        }

        function limparFormulario() {
            document.getElementById('nomeMateria').value = '';
            document.getElementById('materiaCustomizada').value = '';
            document.getElementById('materiaCustomizada').style.display = 'none';
            document.getElementById('pesoMateria').value = '5';
            document.getElementById('dificuldadeMateria').value = '3';
            document.getElementById('prioridadeMateria').value = '3';
        }

        function removerMateria(index) {
            if (confirm('Tem certeza que deseja remover esta matéria?')) {
                materias.splice(index, 1);
                salvarDados();
                atualizarTabela();
                atualizarSelectsMaterias();
                
                if (cicloAtual.length > 0) {
                    gerarCiclo();
                }
            }
        }

        function limparTudo() {
            if (confirm('Tem certeza que deseja limpar todas as matérias e reiniciar?')) {
                materias = [];
                cicloAtual = [];
                sessaoAtualIndex = 0;
                sessoesConcluidas = 0;
                
                salvarDados();
                atualizarTabela();
                atualizarVisualizacaoCiclo();
                atualizarEstatisticas();
                atualizarSelectsMaterias();
                
                mostrarNotificacao('✅ Dados limpos com sucesso!', 'sucesso');
            }
        }

        function atualizarTabela() {
            const tbody = document.querySelector('#tabelaMaterias tbody');
            tbody.innerHTML = '';

            materias.forEach((materia, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${materia.nome}</td>
                    <td>${materia.importancia}</td>
                    <td>${materia.dificuldade}</td>
                    <td>${materia.prioridade}</td>
                    <td>${materia.pontuacao.toFixed(1)}</td>
                    <td>${materia.duracaoSessao}min</td>
                    <td>${materia.sessoes || 0}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removerMateria(${index})" 
                                style="padding: 8px 12px; margin: 0; font-size: 12px;">❌</button>
                    </td>
                `;
            });
        }

        function atualizarSelectsMaterias() {
            const selectLivre = document.getElementById('materiaLivre');
            const selectPomodoro = document.getElementById('materiaPomodoro');
            
            // Limpar opções existentes (exceto "Outra Matéria")
            selectLivre.innerHTML = '<option value="Outra Matéria">Outra Matéria</option>';
            selectPomodoro.innerHTML = '<option value="Outra Matéria">Outra Matéria</option>';
            
            // Adicionar matérias cadastradas
            materias.forEach(materia => {
                const optionLivre = document.createElement('option');
                optionLivre.value = materia.nome;
                optionLivre.textContent = materia.nome;
                selectLivre.appendChild(optionLivre);
                
                const optionPomodoro = document.createElement('option');
                optionPomodoro.value = materia.nome;
                optionPomodoro.textContent = materia.nome;
                selectPomodoro.appendChild(optionPomodoro);
            });
        }

        // ===== FUNÇÕES DO CICLO =====
        function calcularSessoesPorMateria() {
            const sessoesSemanais = parseInt(document.getElementById('sessoesSemanais').textContent) || 10;
            const totalPontuacao = materias.reduce((sum, m) => sum + m.pontuacao, 0);
            
            const frequenciaMinima = Math.max(2, Math.ceil(sessoesSemanais / 10));
            const frequenciaMaxima = Math.ceil(sessoesSemanais / 2);
            
            let sessoesTotais = 0;
            
            materias.forEach(materia => {
                const percentual = materia.pontuacao / totalPontuacao;
                const sessoesCalculadas = Math.round(percentual * sessoesSemanais);
                
                materia.sessoes = Math.max(frequenciaMinima, Math.min(frequenciaMaxima, sessoesCalculadas));
                sessoesTotais += materia.sessoes;
            });
            
            if (sessoesTotais > sessoesSemanais * 1.2) {
                const fatorAjuste = (sessoesSemanais * 1.1) / sessoesTotais;
                materias.forEach(materia => {
                    materia.sessoes = Math.max(frequenciaMinima, Math.round(materia.sessoes * fatorAjuste));
                });
            }
        }

        function gerarCiclo() {
            if (materias.length === 0) {
                mostrarNotificacao('❌ Adicione pelo menos uma matéria antes de gerar o ciclo', 'erro');
                return;
            }

            try {
                calcularSessoesPorMateria();
                
                cicloAtual = [];
                
                materias.forEach(materia => {
                    for (let i = 0; i < materia.sessoes; i++) {
                        cicloAtual.push({
                            materia: materia.nome,
                            dificuldade: materia.dificuldade,
                            importancia: materia.importancia,
                            prioridade: materia.prioridade,
                            duracao: materia.duracaoSessao,
                            concluida: false
                        });
                    }
                });

                embaralharCiclo();
                
                sessaoAtualIndex = 0;
                sessoesConcluidas = 0;
                
                salvarDados();
                atualizarTabela();
                atualizarVisualizacaoCiclo();
                atualizarEstatisticas();
                
                const primeiraSessao = cicloAtual[0];
                mostrarNotificacao(`🎉 Ciclo gerado! ${cicloAtual.length} sessões. Primeira: ${primeiraSessao.materia} (${primeiraSessao.duracao}min)`, 'sucesso');
                
            } catch (error) {
                console.error('❌ Erro ao gerar ciclo:', error);
                mostrarNotificacao('❌ Erro ao gerar ciclo. Tente novamente.', 'erro');
            }
        }

        function embaralharCiclo() {
            const materiasPorNome = {};
            cicloAtual.forEach(sessao => {
                if (!materiasPorNome[sessao.materia]) {
                    materiasPorNome[sessao.materia] = [];
                }
                materiasPorNome[sessao.materia].push(sessao);
            });

            const resultado = [];
            const nomes = Object.keys(materiasPorNome);
            const intervalosIdeal = {};
            const ultimaPosicao = {};
            
            nomes.forEach(nome => {
                const sessoesDaMateria = materiasPorNome[nome].length;
                const intervaloIdeal = Math.max(3, Math.floor(cicloAtual.length / sessoesDaMateria));
                intervalosIdeal[nome] = Math.min(intervaloIdeal, 8);
                ultimaPosicao[nome] = -intervalosIdeal[nome];
            });

            for (let posicao = 0; posicao < cicloAtual.length; posicao++) {
                let melhorMateria = null;
                let melhorPrioridade = -1;
                
                nomes.forEach(nome => {
                    const sessoesDaMateria = materiasPorNome[nome];
                    if (sessoesDaMateria.length === 0) return;
                    
                    const intervaloAtual = posicao - ultimaPosicao[nome];
                    const intervaloMinimo = intervalosIdeal[nome];
                    
                    let prioridade = 0;
                    
                    if (intervaloAtual >= intervaloMinimo) {
                        const sessao = sessoesDaMateria[0];
                        const urgencia = Math.min(intervaloAtual / intervaloMinimo, 2);
                        prioridade = sessao.importancia * sessao.dificuldade * sessao.prioridade * urgencia;
                        
                        if (intervaloAtual > intervaloMinimo * 1.5) {
                            prioridade *= 1.5;
                        }
                    }
                    
                    if (prioridade > melhorPrioridade) {
                        melhorPrioridade = prioridade;
                        melhorMateria = nome;
                    }
                });
                
                if (!melhorMateria) {
                    let maiorIntervalo = -1;
                    nomes.forEach(nome => {
                        const sessoesDaMateria = materiasPorNome[nome];
                        if (sessoesDaMateria.length > 0) {
                            const intervaloAtual = posicao - ultimaPosicao[nome];
                            if (intervaloAtual > maiorIntervalo) {
                                maiorIntervalo = intervaloAtual;
                                melhorMateria = nome;
                            }
                        }
                    });
                }
                
                if (melhorMateria && materiasPorNome[melhorMateria].length > 0) {
                    const sessao = materiasPorNome[melhorMateria].shift();
                    resultado.push(sessao);
                    ultimaPosicao[melhorMateria] = posicao;
                }
            }

            cicloAtual = resultado;
        }

        function atualizarVisualizacaoCiclo() {
            const container = document.getElementById('cicloContainer');
            const info = document.getElementById('cicloInfo');
            const stats = document.getElementById('statsContainer');
            const progresso = document.getElementById('progressoContainer');
            const controles = document.getElementById('controlesContainer');
            
            if (cicloAtual.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; font-style: italic;">Adicione matérias e clique em "Gerar Ciclo" para começar</p>';
                if (info) info.style.display = 'none';
                if (stats) stats.style.display = 'none';
                if (progresso) progresso.style.display = 'none';
                if (controles) controles.style.display = 'none';
                return;
            }

            if (info) info.style.display = 'block';
            if (stats) stats.style.display = 'grid';
            if (progresso) progresso.style.display = 'block';
            if (controles) controles.style.display = 'block';

            let html = '';
            
            cicloAtual.forEach((sessao, index) => {
                const isAtual = index === sessaoAtualIndex;
                const isConcluida = sessao.concluida;
                
                let classe = '';
                if (isConcluida) classe = 'concluido';
                else if (isAtual) classe = 'atual';
                
                let icone = '';
                switch(sessao.dificuldade) {
                    case 5: icone = '🔴'; break;
                    case 4: icone = '🟠'; break;
                    case 3: icone = '🟡'; break;
                    case 2: icone = '🟢'; break;
                    case 1: icone = '🔵'; break;
                }

                const status = isConcluida ? '✅' : (isAtual ? '👉' : '⏳');
                
                html += `
                    <div class="ciclo-item ${classe}">
                        <div class="ciclo-info">
                            <h4>${status} ${icone} ${sessao.materia}</h4>
                            <small>Sessão ${index + 1} de ${cicloAtual.length} | Imp: ${sessao.importancia} | Dif: ${sessao.dificuldade} | Pri: ${sessao.prioridade}</small>
                        </div>
                        <div class="ciclo-tempo ${classe}">${sessao.duracao}min</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function atualizarEstatisticas() {
            if (cicloAtual.length === 0) return;
            
            const totalSessoes = cicloAtual.length;
            const tempoTotal = cicloAtual.reduce((sum, s) => sum + s.duracao, 0);
            const tempoCompletoCiclo = (tempoTotal / 60).toFixed(1);
            
            const horasSegSex = parseFloat(document.getElementById('horasSegSex').value) || 2;
            const horasSabado = parseFloat(document.getElementById('horasSabado').value) || 4;
            const horasDomingo = parseFloat(document.getElementById('horasDomingo').value) || 3;
            const horasPorDia = (horasSegSex * 5 + horasSabado + horasDomingo) / 7;
            const diasPrevisto = Math.ceil((tempoTotal / 60) / horasPorDia);
            
            document.getElementById('totalSessoes').textContent = totalSessoes;
            document.getElementById('tempoCompletoCiclo').textContent = tempoCompletoCiclo + 'h';
            document.getElementById('diasPrevisto').textContent = diasPrevisto;
            document.getElementById('sessaoAtual').textContent = sessaoAtualIndex + 1;
            
            const progressoFill = document.getElementById('progressoFill');
            if (progressoFill) {
                const percentual = (sessoesConcluidas / totalSessoes) * 100;
                progressoFill.style.width = percentual + '%';
            }
        }

        function marcarConcluida() {
            if (cicloAtual.length === 0) {
                mostrarNotificacao('❌ Gere um ciclo primeiro!', 'erro');
                return;
            }
            
            if (sessaoAtualIndex >= cicloAtual.length) {
                mostrarNotificacao('🎉 Ciclo concluído! Será reiniciado automaticamente.', 'sucesso');
                reiniciarCiclo();
                return;
            }
            
            const sessaoAtual = cicloAtual[sessaoAtualIndex];
            
            if (sessaoAtual.concluida) {
                mostrarNotificacao('⚠️ Esta sessão já foi concluída!', 'aviso');
                return;
            }
            
            sessaoAtual.concluida = true;
            sessoesConcluidas++;
            
            registrarSessao(sessaoAtual.materia, sessaoAtual.duracao);
            
            sessaoAtualIndex++;
            
            if (sessaoAtualIndex >= cicloAtual.length) {
                estatisticasGerais.ciclosCompletos++;
                mostrarNotificacao('🎉 Parabéns! Você completou um ciclo!', 'sucesso');
                reiniciarCiclo();
                return;
            }
            
            salvarDados();
            atualizarVisualizacaoCiclo();
            atualizarEstatisticas();
            
            const proximaSessao = cicloAtual[sessaoAtualIndex];
            mostrarNotificacao(`✅ Sessão concluída! Próxima: ${proximaSessao.materia} (${proximaSessao.duracao}min)`, 'sucesso');
        }

        function reiniciarCiclo() {
            if (cicloAtual.length === 0) {
                mostrarNotificacao('❌ Gere um ciclo primeiro!', 'erro');
                return;
            }
            
            cicloAtual.forEach(sessao => {
                sessao.concluida = false;
            });
            
            embaralharCiclo();
            
            sessaoAtualIndex = 0;
            sessoesConcluidas = 0;
            
            salvarDados();
            atualizarVisualizacaoCiclo();
            atualizarEstatisticas();
            
            const primeiraSessao = cicloAtual[0];
            mostrarNotificacao(`🔄 Ciclo reiniciado! Primeira sessão: ${primeiraSessao.materia} (${primeiraSessao.duracao}min)`, 'sucesso');
        }

        function imprimirCiclo() {
            if (cicloAtual.length === 0) {
                mostrarNotificacao('❌ Gere um ciclo primeiro!', 'erro');
                return;
            }
            
            let conteudo = `
                <html>
                <head>
                    <title>Checklist - Ciclo de Estudos</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .sessao { 
                            display: flex; 
                            justify-content: space-between; 
                            align-items: center;
                            padding: 10px; 
                            border-bottom: 1px solid #ddd; 
                            margin: 5px 0;
                        }
                        .checkbox { width: 20px; height: 20px; margin-right: 10px; }
                        .materia { font-weight: bold; flex: 1; }
                        .duracao { 
                            background: #4a5568; 
                            color: white; 
                            padding: 4px 8px; 
                            border-radius: 10px; 
                            font-size: 12px;
                        }
                        .info { color: #666; font-size: 12px; margin-left: 30px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>🎯 Checklist - Ciclo de Estudos</h1>
                        <p>Data: ${new Date().toLocaleDateString('pt-BR')}</p>
                        <p>Total de sessões: ${cicloAtual.length} | Tempo total: ${(cicloAtual.reduce((sum, s) => sum + s.duracao, 0) / 60).toFixed(1)}h</p>
                    </div>
            `;
            
            cicloAtual.forEach((sessao, index) => {
                let icone = '';
                switch(sessao.dificuldade) {
                    case 5: icone = '🔴'; break;
                    case 4: icone = '🟠'; break;
                    case 3: icone = '🟡'; break;
                    case 2: icone = '🟢'; break;
                    case 1: icone = '🔵'; break;
                }
                
                conteudo += `
                    <div class="sessao">
                        <input type="checkbox" class="checkbox">
                        <div class="materia">${index + 1}. ${icone} ${sessao.materia}</div>
                        <div class="duracao">${sessao.duracao}min</div>
                    </div>
                    <div class="info">Importância: ${sessao.importancia} | Dificuldade: ${sessao.dificuldade} | Prioridade: ${sessao.prioridade}</div>
                `;
            });
            
            conteudo += `</body></html>`;
            
            const janela = window.open('', '_blank');
            janela.document.write(conteudo);
            janela.document.close();
            janela.print();
        }

        // ===== FUNÇÕES DOS CRONÔMETROS =====
        
        // Cronômetro Meta de Estudos
        function iniciarCronometroMeta() {
            if (cicloAtual.length === 0) {
                mostrarNotificacao('❌ Gere um ciclo primeiro!', 'erro');
                return;
            }
            
            if (sessaoAtualIndex >= cicloAtual.length) {
                mostrarNotificacao('🎉 Ciclo concluído! Reinicie para continuar.', 'sucesso');
                return;
            }
            
            const sessao = cicloAtual[sessaoAtualIndex];
            cronometros.meta.sessao = sessao;
            cronometros.meta.tempoMeta = sessao.duracao * 60;
            
            if (!cronometros.meta.ativo) {
                cronometros.meta.inicio = Date.now();
                cronometros.meta.decorrido = 0;
            } else if (cronometros.meta.pausado) {
                cronometros.meta.inicio = Date.now() - cronometros.meta.decorrido;
            }
            
            cronometros.meta.ativo = true;
            cronometros.meta.pausado = false;
            
            document.getElementById('playMeta').disabled = true;
            document.getElementById('pauseMeta').disabled = false;
            document.getElementById('stopMeta').disabled = false;
            document.getElementById('completeMeta').disabled = false;
            
            document.getElementById('infoMeta').textContent = `📚 Estudando: ${sessao.materia}`;
            document.getElementById('metaMeta').textContent = `Meta: ${formatarTempoMM(cronometros.meta.tempoMeta)}`;
            document.getElementById('cronometroMeta').classList.add('ativo');
            
            if (cronometros.meta.intervalo) clearInterval(cronometros.meta.intervalo);
            cronometros.meta.intervalo = setInterval(() => atualizarCronometro('meta'), 1000);
            
            mostrarNotificacao(`⏱️ Cronômetro iniciado: ${sessao.materia} (${sessao.duracao}min)`, 'sucesso');
        }

        function pausarCronometroMeta() {
            if (!cronometros.meta.ativo) return;
            
            cronometros.meta.pausado = true;
            clearInterval(cronometros.meta.intervalo);
            
            document.getElementById('playMeta').disabled = false;
            document.getElementById('pauseMeta').disabled = true;
            document.getElementById('cronometroMeta').classList.remove('ativo');
            
            mostrarNotificacao('⏸️ Cronômetro pausado', 'info');
        }

        function pararCronometroMeta() {
            if (!cronometros.meta.ativo && !cronometros.meta.pausado) return;
            
            const tempoEstudado = Math.ceil(cronometros.meta.decorrido / 60000);
            
            cronometros.meta.ativo = false;
            cronometros.meta.pausado = false;
            clearInterval(cronometros.meta.intervalo);
            
            cronometros.meta.decorrido = 0;
            cronometros.meta.tempoMeta = 0;
            cronometros.meta.sessao = null;
            
            document.getElementById('playMeta').disabled = false;
            document.getElementById('pauseMeta').disabled = true;
            document.getElementById('stopMeta').disabled = true;
            document.getElementById('completeMeta').disabled = true;
            
            document.getElementById('tempoMeta').textContent = '00:00';
            document.getElementById('infoMeta').textContent = 'Próxima sessão: Clique em Iniciar';
            document.getElementById('metaMeta').textContent = 'Meta: --:--';
            document.getElementById('fillMeta').style.width = '0%';
            document.getElementById('cronometroMeta').classList.remove('ativo');
            
            if (tempoEstudado >= 1) {
                const sessao = cicloAtual[sessaoAtualIndex];
                if (sessao) {
                    registrarSessao(sessao.materia, tempoEstudado);
                    mostrarNotificacao(`⏹️ Sessão parada. Tempo registrado: ${tempoEstudado}min`, 'info');
                }
            }
            
            atualizarEstatisticasDia();
        }

        function completarSessaoMeta() {
            if (!cronometros.meta.ativo && !cronometros.meta.pausado) return;
            
            const tempoEstudado = Math.ceil(cronometros.meta.decorrido / 60000);
            
            pararCronometroMeta();
            
            if (tempoEstudado >= 5) {
                marcarConcluida();
                mostrarNotificacao(`✅ Sessão completada: ${tempoEstudado}min estudados`, 'sucesso');
            } else {
                mostrarNotificacao('⚠️ Sessão muito curta! Estude pelo menos 5 minutos.', 'aviso');
            }
        }

        // Cronômetro Tempo Livre
        function iniciarCronometroLivre() {
            const materia = document.getElementById('materiaLivre').value;
            const tempoMinutos = parseInt(document.getElementById('tempoLivreInput').value) || 30;
            
            cronometros.livre.materia = materia;
            cronometros.livre.tempoMeta = tempoMinutos * 60;
            
            if (!cronometros.livre.ativo) {
                cronometros.livre.inicio = Date.now();
                cronometros.livre.decorrido = 0;
            } else if (cronometros.livre.pausado) {
                cronometros.livre.inicio = Date.now() - cronometros.livre.decorrido;
            }
            
            cronometros.livre.ativo = true;
            cronometros.livre.pausado = false;
            
            document.getElementById('playLivre').disabled = true;
            document.getElementById('pauseLivre').disabled = false;
            document.getElementById('stopLivre').disabled = false;
            document.getElementById('completeLivre').disabled = false;
            
            document.getElementById('cronometroLivre').classList.add('ativo');
            
            if (cronometros.livre.intervalo) clearInterval(cronometros.livre.intervalo);
            cronometros.livre.intervalo = setInterval(() => atualizarCronometro('livre'), 1000);
            
            mostrarNotificacao(`⏱️ Tempo livre iniciado: ${materia} (${tempoMinutos}min)`, 'sucesso');
        }

        function pausarCronometroLivre() {
            if (!cronometros.livre.ativo) return;
            
            cronometros.livre.pausado = true;
            clearInterval(cronometros.livre.intervalo);
            
            document.getElementById('playLivre').disabled = false;
            document.getElementById('pauseLivre').disabled = true;
            document.getElementById('cronometroLivre').classList.remove('ativo');
            
            mostrarNotificacao('⏸️ Cronômetro pausado', 'info');
        }

        function pararCronometroLivre() {
            if (!cronometros.livre.ativo && !cronometros.livre.pausado) return;
            
            const tempoEstudado = Math.ceil(cronometros.livre.decorrido / 60000);
            
            cronometros.livre.ativo = false;
            cronometros.livre.pausado = false;
            clearInterval(cronometros.livre.intervalo);
            
            cronometros.livre.decorrido = 0;
            cronometros.livre.tempoMeta = 30 * 60;
            
            document.getElementById('playLivre').disabled = false;
            document.getElementById('pauseLivre').disabled = true;
            document.getElementById('stopLivre').disabled = true;
            document.getElementById('completeLivre').disabled = true;
            
            document.getElementById('tempoLivre').textContent = '00:00';
            document.getElementById('fillLivre').style.width = '0%';
            document.getElementById('cronometroLivre').classList.remove('ativo');
            
            if (tempoEstudado >= 1) {
                registrarSessao(cronometros.livre.materia, tempoEstudado);
                mostrarNotificacao(`⏹️ Sessão parada. Tempo registrado: ${tempoEstudado}min`, 'info');
            }
            
            atualizarEstatisticasDia();
        }

        function completarSessaoLivre() {
            if (!cronometros.livre.ativo && !cronometros.livre.pausado) return;
            
            const tempoEstudado = Math.ceil(cronometros.livre.decorrido / 60000);
            
            pararCronometroLivre();
            
            if (tempoEstudado >= 5) {
                mostrarNotificacao(`✅ Sessão livre completada: ${tempoEstudado}min`, 'sucesso');
            } else {
                mostrarNotificacao('⚠️ Sessão muito curta! Estude pelo menos 5 minutos.', 'aviso');
            }
        }

        // Cronômetro Pomodoro
        function iniciarCronometroPomodoro() {
            const materia = document.getElementById('materiaPomodoro').value;
            cronometros.pomodoro.materia = materia;
            
            if (!cronometros.pomodoro.ativo) {
                cronometros.pomodoro.inicio = Date.now();
                cronometros.pomodoro.decorrido = 0;
            } else if (cronometros.pomodoro.pausado) {
                cronometros.pomodoro.inicio = Date.now() - cronometros.pomodoro.decorrido;
            }
            
            cronometros.pomodoro.ativo = true;
            cronometros.pomodoro.pausado = false;
            
            document.getElementById('playPomodoro').disabled = true;
            document.getElementById('pausePomodoro').disabled = false;
            document.getElementById('stopPomodoro').disabled = false;
            document.getElementById('skipPomodoro').disabled = false;
            
            document.getElementById('cronometroPomodoro').classList.add('ativo');
            
            if (cronometros.pomodoro.intervalo) clearInterval(cronometros.pomodoro.intervalo);
            cronometros.pomodoro.intervalo = setInterval(() => atualizarCronometro('pomodoro'), 1000);
            
            const fase = cronometros.pomodoro.fase === 'estudo' ? 'estudo' : 'pausa';
            mostrarNotificacao(`🍅 Pomodoro iniciado: ${fase} (${materia})`, 'sucesso');
        }

        function pausarCronometroPomodoro() {
            if (!cronometros.pomodoro.ativo) return;
            
            cronometros.pomodoro.pausado = true;
            clearInterval(cronometros.pomodoro.intervalo);
            
            document.getElementById('playPomodoro').disabled = false;
            document.getElementById('pausePomodoro').disabled = true;
            document.getElementById('cronometroPomodoro').classList.remove('ativo');
            
            mostrarNotificacao('⏸️ Pomodoro pausado', 'info');
        }

        function pararCronometroPomodoro() {
            if (!cronometros.pomodoro.ativo && !cronometros.pomodoro.pausado) return;
            
            const tempoEstudado = cronometros.pomodoro.fase === 'estudo' ? Math.ceil(cronometros.pomodoro.decorrido / 60000) : 0;
            
            cronometros.pomodoro.ativo = false;
            cronometros.pomodoro.pausado = false;
            clearInterval(cronometros.pomodoro.intervalo);
            
            cronometros.pomodoro.decorrido = 0;
            cronometros.pomodoro.tempoMeta = 25 * 60;
            cronometros.pomodoro.fase = 'estudo';
            cronometros.pomodoro.ciclo = 1;
            
            document.getElementById('playPomodoro').disabled = false;
            document.getElementById('pausePomodoro').disabled = true;
            document.getElementById('stopPomodoro').disabled = true;
            document.getElementById('skipPomodoro').disabled = true;
            
            document.getElementById('tempoPomodoro').textContent = '25:00';
            document.getElementById('fillPomodoro').style.width = '0%';
            document.getElementById('fasePomodoro').textContent = 'Estudo';
            document.getElementById('cronometroPomodoro').classList.remove('ativo');
            
            if (tempoEstudado >= 1) {
                registrarSessao(cronometros.pomodoro.materia, tempoEstudado);
                mostrarNotificacao(`⏹️ Pomodoro parado. Tempo registrado: ${tempoEstudado}min`, 'info');
            }
            
            atualizarEstatisticasDia();
        }

        function pularFasePomodoro() {
            if (!cronometros.pomodoro.ativo && !cronometros.pomodoro.pausado) return;
            
            const tempoEstudado = cronometros.pomodoro.fase === 'estudo' ? Math.ceil(cronometros.pomodoro.decorrido / 60000) : 0;
            
            if (cronometros.pomodoro.fase === 'estudo') {
                // Registrar tempo de estudo
                if (tempoEstudado >= 1) {
                    registrarSessao(cronometros.pomodoro.materia, tempoEstudado);
                    cronometros.pomodoro.tempoFocoHoje += tempoEstudado;
                    cronometros.pomodoro.pomodorosHoje++;
                    estatisticasGerais.pomodorosCompletos++;
                }
                
                // Mudar para pausa
                cronometros.pomodoro.fase = 'pausa';
                cronometros.pomodoro.tempoMeta = 5 * 60; // 5 minutos de pausa
                document.getElementById('fasePomodoro').textContent = 'Pausa';
                document.getElementById('metaPomodoro').textContent = '5min pausa → 25min estudo';
                
                mostrarNotificacao('☕ Hora da pausa! 5 minutos para relaxar.', 'info');
            } else {
                // Mudar para estudo
                cronometros.pomodoro.fase = 'estudo';
                cronometros.pomodoro.tempoMeta = 25 * 60; // 25 minutos de estudo
                cronometros.pomodoro.ciclo++;
                document.getElementById('fasePomodoro').textContent = 'Estudo';
                document.getElementById('cicloPomodoro').textContent = cronometros.pomodoro.ciclo;
                document.getElementById('metaPomodoro').textContent = '25min estudo → 5min pausa';
                
                mostrarNotificacao('📚 Volta aos estudos! Novo pomodoro iniciado.', 'sucesso');
            }
            
            // Resetar cronômetro para nova fase
            cronometros.pomodoro.inicio = Date.now();
            cronometros.pomodoro.decorrido = 0;
            
            atualizarEstatisticasDia();
        }

        // Função universal para atualizar cronômetros
        function atualizarCronometro(tipo) {
            const cronometro = cronometros[tipo];
            if (!cronometro.ativo) return;
            
            cronometro.decorrido = Date.now() - cronometro.inicio;
            const segundos = Math.floor(cronometro.decorrido / 1000);
            
            // Atualizar display
            document.getElementById(`tempo${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`).textContent = formatarTempoMM(segundos);
            
            // Atualizar barra de progresso
            if (cronometro.tempoMeta > 0) {
                const progresso = Math.min((segundos / cronometro.tempoMeta) * 100, 100);
                document.getElementById(`fill${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`).style.width = progresso + '%';
                
                // Mudança de cor conforme progresso
                const fill = document.getElementById(`fill${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
                if (progresso >= 100) {
                    fill.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                } else if (progresso >= 90) {
                    fill.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                } else {
                    fill.style.background = 'linear-gradient(90deg, #4ade80, #22c55e)';
                }
            }
            
            // Notificação quando atingir a meta
            if (cronometro.tempoMeta > 0 && segundos >= cronometro.tempoMeta && segundos <= cronometro.tempoMeta + 2) {
                if (tipo === 'pomodoro') {
                    pularFasePomodoro();
                } else {
                    mostrarNotificacao(`🎯 Meta atingida! ${tipo === 'meta' ? 'Sessão' : 'Tempo'} completado.`, 'sucesso');
                }
                
                // Vibração se disponível
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }
        }

        function formatarTempoMM(segundos) {
            const mins = Math.floor(segundos / 60);
            const secs = segundos % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ===== FUNÇÕES DE HISTÓRICO E ESTATÍSTICAS =====
        
        function registrarSessao(materia, duracao) {
            const registro = {
                materia: materia,
                duracao: duracao,
                data: new Date().toISOString(),
                timestamp: Date.now()
            };
            
            historicoEstudos.push(registro);
            
            estatisticasGerais.totalSessoes++;
            estatisticasGerais.totalTempo += duracao;
            
            if (!estatisticasGerais.tempoTotalPorMateria[materia]) {
                estatisticasGerais.tempoTotalPorMateria[materia] = 0;
            }
            estatisticasGerais.tempoTotalPorMateria[materia] += duracao;
            
            salvarDados();
            atualizarHistorico();
            atualizarMateriasHoje();
            atualizarEstatisticasDia();
        }

        function recuperarHistoricoHoje() {
            const hoje = new Date().toDateString();
            return historicoEstudos.filter(sessao => {
                const dataSessao = new Date(sessao.data).toDateString();
                return dataSessao === hoje;
            });
        }

        function atualizarEstatisticasDia() {
            const sessoesHoje = recuperarHistoricoHoje();
            const tempoHoje = sessoesHoje.reduce((total, sessao) => total + sessao.duracao, 0);
            const quantidadeHoje = sessoesHoje.length;
            
            // Matérias únicas estudadas hoje
            const materiasUnicas = new Set(sessoesHoje.map(s => s.materia)).size;
            
            // Meta diária (baseada nas horas configuradas)
            const horasSegSex = parseFloat(document.getElementById('horasSegSex').value) || 2;
            const metaDiaria = horasSegSex * 60; // em minutos
            const percentualMeta = Math.min((tempoHoje / metaDiaria) * 100, 100);
            
            // Converter para horas e minutos
            const horas = Math.floor(tempoHoje / 60);
            const minutos = tempoHoje % 60;
            
            // Atualizar interface
            document.getElementById('tempoTotalHoje').textContent = `${horas}h${minutos.toString().padStart(2, '0')}min`;
            document.getElementById('sessoesTotalHoje').textContent = quantidadeHoje;
            document.getElementById('materiasHoje').textContent = materiasUnicas;
            document.getElementById('metaHoje').textContent = `${percentualMeta.toFixed(0)}%`;
            
            // Atualizar estatísticas do Pomodoro
            document.getElementById('pomodorosCompletos').textContent = cronometros.pomodoro.pomodorosHoje;
            document.getElementById('tempoFoco').textContent = `${cronometros.pomodoro.tempoFocoHoje}min`;
        }

        function atualizarMateriasHoje() {
            const sessoesHoje = recuperarHistoricoHoje();
            const materiasHojeSection = document.getElementById('materiasHojeSection');
            
            if (sessoesHoje.length === 0) {
                materiasHojeSection.style.display = 'none';
                return;
            }
            
            materiasHojeSection.style.display = 'block';
            
            // Agrupar sessões por matéria
            const materiasPorNome = {};
            sessoesHoje.forEach(sessao => {
                if (!materiasPorNome[sessao.materia]) {
                    materiasPorNome[sessao.materia] = {
                        nome: sessao.materia,
                        sessoes: 0,
                        tempoTotal: 0,
                        ultimaSessao: null
                    };
                }
                materiasPorNome[sessao.materia].sessoes++;
                materiasPorNome[sessao.materia].tempoTotal += sessao.duracao;
                materiasPorNome[sessao.materia].ultimaSessao = new Date(sessao.data);
            });
            
            const materiasArray = Object.values(materiasPorNome);
            const tempoTotalHoje = sessoesHoje.reduce((total, sessao) => total + sessao.duracao, 0);
            
            // Ordenar por tempo total
            materiasArray.sort((a, b) => b.tempoTotal - a.tempoTotal);
            
            // Atualizar estatísticas
            const estatisticasDiv = document.getElementById('materiasHojeEstatisticas');
            const horasHoje = (tempoTotalHoje / 60).toFixed(1);
            const materiasUnicas = materiasArray.length;
            const mediaPorMateria = materiasUnicas > 0 ? (tempoTotalHoje / materiasUnicas).toFixed(0) : 0;
            const maiorTempo = materiasArray.length > 0 ? materiasArray[0] : null;
            
            estatisticasDiv.innerHTML = `
                <div class="stat-card">
                    <h3>${horasHoje}h</h3>
                    <p>Tempo Total Hoje</p>
                </div>
                <div class="stat-card">
                    <h3>${materiasUnicas}</h3>
                    <p>Matérias Diferentes</p>
                </div>
                <div class="stat-card">
                    <h3>${mediaPorMateria}min</h3>
                    <p>Média por Matéria</p>
                </div>
                <div class="stat-card">
                    <h3>${maiorTempo ? maiorTempo.nome : 'N/A'}</h3>
                    <p>Matéria Mais Estudada</p>
                </div>
            `;
            
            // Criar gráfico de barras
            const graficoDiv = document.getElementById('materiasHojeGrafico');
            let htmlGrafico = '';
            
            materiasArray.forEach((materia, index) => {
                const percentual = (materia.tempoTotal / tempoTotalHoje) * 100;
                const tempoHoras = (materia.tempoTotal / 60).toFixed(1);
                const ultimaHora = materia.ultimaSessao.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const cores = [
                    '#4ade80', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6',
                    '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                ];
                const cor = cores[index % cores.length];
                
                htmlGrafico += `
                    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid ${cor}; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div>
                                <strong style="color: #2d3748; font-size: 16px;">${materia.nome}</strong>
                                <div style="color: #6c757d; font-size: 12px; margin-top: 2px;">
                                    ${materia.sessoes} sessão${materia.sessoes > 1 ? 'ões' : ''} • Última: ${ultimaHora}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: ${cor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${materia.tempoTotal}min
                                </div>
                                <div style="color: #6c757d; font-size: 11px; margin-top: 2px;">
                                    ${tempoHoras}h
                                </div>
                            </div>
                        </div>
                        <div style="background: #ecf0f1; border-radius: 10px; height: 8px; overflow: hidden;">
                            <div style="background: ${cor}; height: 100%; width: ${percentual}%; transition: width 0.3s ease; border-radius: 10px;"></div>
                        </div>
                        <div style="text-align: right; color: #6c757d; font-size: 11px; margin-top: 4px;">
                            ${percentual.toFixed(1)}% do tempo total
                        </div>
                    </div>
                `;
            });
            
            graficoDiv.innerHTML = htmlGrafico;
        }

        function atualizarHistorico() {
            const historicoSection = document.getElementById('historicoSection');
            const dadosSection = document.getElementById('dadosSection');
            
            if (historicoEstudos.length === 0) {
                historicoSection.style.display = 'none';
                dadosSection.style.display = 'none';
                return;
            }
            
            historicoSection.style.display = 'block';
            dadosSection.style.display = 'block';
            
            // Atualizar estatísticas
            const estatisticasDiv = document.getElementById('historicoEstatisticas');
            const totalHoras = (estatisticasGerais.totalTempo / 60).toFixed(1);
            const mediaPorDia = historicoEstudos.length > 0 ? 
                (estatisticasGerais.totalTempo / getDiasEstudados()).toFixed(0) : 0;
            
            estatisticasDiv.innerHTML = `
                <div class="stat-card">
                    <h3>${estatisticasGerais.totalSessoes}</h3>
                    <p>Sessões Concluídas</p>
                </div>
                <div class="stat-card">
                    <h3>${totalHoras}h</h3>
                    <p>Tempo Total</p>
                </div>
                <div class="stat-card">
                    <h3>${estatisticasGerais.ciclosCompletos}</h3>
                    <p>Ciclos Completos</p>
                </div>
                <div class="stat-card">
                    <h3>${mediaPorDia}min</h3>
                    <p>Média por Dia</p>
                </div>
            `;
            
            // Atualizar lista de histórico
            const historicoLista = document.getElementById('historicoLista');
            const ultimasSessoes = historicoEstudos.slice(-20).reverse();
            
            let htmlHistorico = '';
            
            ultimasSessoes.forEach(sessao => {
                const data = new Date(sessao.data);
                const dataFormatada = data.toLocaleDateString('pt-BR');
                const horaFormatada = data.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                htmlHistorico += `
                    <div style="background: white; padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #4a5568; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${sessao.materia}</strong>
                            <br>
                            <small style="color: #6c757d;">${dataFormatada} às ${horaFormatada}</small>
                        </div>
                        <div style="text-align: right;">
                            <span style="background: #4a5568; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                ${sessao.duracao}min
                            </span>
                        </div>
                    </div>
                `;
            });
            
            historicoLista.innerHTML = htmlHistorico;
        }

        function getDiasEstudados() {
            if (historicoEstudos.length === 0) return 1;
            
            const datas = new Set();
            historicoEstudos.forEach(sessao => {
                const data = new Date(sessao.data).toDateString();
                datas.add(data);
            });
            
            return Math.max(1, datas.size);
        }

        // ===== FUNÇÕES DE DADOS =====
        
        function exportarDados() {
            const dados = {
                materias: materias,
                cicloAtual: cicloAtual,
                sessaoAtualIndex: sessaoAtualIndex,
                sessoesConcluidas: sessoesConcluidas,
                historicoEstudos: historicoEstudos,
                estatisticasGerais: estatisticasGerais,
                dataExportacao: new Date().toISOString(),
                versao: "2.0"
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cronometro-estudos-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            mostrarNotificacao('📤 Dados exportados com sucesso!', 'sucesso');
        }

        function importarDados(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    if (!dados.materias || !Array.isArray(dados.materias)) {
                        throw new Error('Arquivo inválido');
                    }
                    
                    if (confirm('Isso substituirá todos os dados atuais. Deseja continuar?')) {
                        materias = dados.materias || [];
                        cicloAtual = dados.cicloAtual || [];
                        sessaoAtualIndex = dados.sessaoAtualIndex || 0;
                        sessoesConcluidas = dados.sessoesConcluidas || 0;
                        historicoEstudos = dados.historicoEstudos || [];
                        estatisticasGerais = dados.estatisticasGerais || {
                            totalSessoes: 0,
                            totalTempo: 0,
                            ciclosCompletos: 0,
                            tempoTotalPorMateria: {},
                            pomodorosCompletos: 0
                        };
                        
                        calcularSessoesPorDia();
                        atualizarTabela();
                        atualizarVisualizacaoCiclo();
                        atualizarEstatisticas();
                        atualizarHistorico();
                        atualizarSelectsMaterias();
                        atualizarEstatisticasDia();
                        
                        salvarDados();
                        
                        mostrarNotificacao('📥 Dados importados com sucesso!', 'sucesso');
                    }
                } catch (error) {
                    mostrarNotificacao('❌ Erro ao importar dados. Verifique se o arquivo está correto.', 'erro');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        function limparHistorico() {
            if (confirm('Tem certeza que deseja limpar todo o histórico? Esta ação não pode ser desfeita.')) {
                historicoEstudos = [];
                estatisticasGerais = {
                    totalSessoes: 0,
                    totalTempo: 0,
                    ciclosCompletos: 0,
                    tempoTotalPorMateria: {},
                    pomodorosCompletos: 0
                };
                
                salvarDados();
                atualizarHistorico();
                atualizarEstatisticasDia();
                
                mostrarNotificacao('🗑️ Histórico limpo com sucesso!', 'sucesso');
            }
        }
    </script>
</body>
</html>

